<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Verification Report - {{ file_name }}</title>
    <style>
        @page {
            size: A4;
            margin: 1.5cm 1.8cm;
            @bottom-right {
                content: "Page " counter(page) " of " counter(pages);
                font-size: 9px;
                color: #6b7280;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica', 'Arial', sans-serif;
            font-size: 11px;
            line-height: 1.6;
            color: #1f2937;
        }

        .header {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 3px solid #3b82f6;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: #3b82f6;
            letter-spacing: -0.5px;
        }

        .report-title {
            text-align: right;
            color: #6b7280;
        }

        .report-title h1 {
            font-size: 18px;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .report-title p {
            font-size: 9px;
            color: #9ca3af;
        }

        .file-info {
            background: #f9fafb;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .file-info p {
            margin: 4px 0;
            font-size: 10px;
        }

        .file-info strong {
            color: #4b5563;
            font-weight: 600;
        }

        .verdict-card {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            text-align: center;
            background: {{ verdict_bg_color }};
            border: 2px solid {{ verdict_color }};
        }

        .verdict-label {
            font-size: 28px;
            font-weight: 700;
            color: {{ verdict_color }};
            margin-bottom: 8px;
            letter-spacing: 1px;
        }

        .verdict-description {
            font-size: 12px;
            color: #4b5563;
            margin-bottom: 16px;
        }

        .risk-score {
            margin: 16px auto 0;
            width: 200px;
        }

        .risk-score-label {
            font-size: 11px;
            color: #6b7280;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .risk-score-bar {
            height: 24px;
            background: #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .risk-score-fill {
            height: 100%;
            background: linear-gradient(90deg,
                #15803d 0%,
                #15803d 30%,
                #d97706 30%,
                #d97706 60%,
                #dc2626 60%,
                #dc2626 100%);
            width: {{ risk_score }}%;
            transition: width 0.3s;
        }

        .risk-score-value {
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            font-size: 11px;
            font-weight: 700;
            color: #1f2937;
        }

        .section {
            margin-bottom: 28px;
            page-break-inside: avoid;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 2px solid #e5e7eb;
        }

        .executive-summary {
            background: #f0f9ff;
            padding: 16px;
            border-left: 4px solid #3b82f6;
            border-radius: 4px;
            font-size: 11px;
            line-height: 1.8;
            color: #1e40af;
        }

        .findings-grid {
            display: grid;
            gap: 12px;
        }

        .finding-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 12px;
            page-break-inside: avoid;
        }

        .finding-card.critical {
            border-left: 4px solid #dc2626;
            background: #fef2f2;
        }

        .finding-card.high {
            border-left: 4px solid #ea580c;
            background: #fff7ed;
        }

        .finding-card.medium {
            border-left: 4px solid #d97706;
            background: #fffbeb;
        }

        .finding-card.low {
            border-left: 4px solid #65a30d;
            background: #f7fee7;
        }

        .finding-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .finding-type {
            font-size: 12px;
            font-weight: 600;
            color: #1f2937;
        }

        .finding-severity {
            font-size: 9px;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .finding-severity.critical {
            background: #dc2626;
            color: white;
        }

        .finding-severity.high {
            background: #ea580c;
            color: white;
        }

        .finding-severity.medium {
            background: #d97706;
            color: white;
        }

        .finding-severity.low {
            background: #65a30d;
            color: white;
        }

        .finding-details {
            font-size: 10px;
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .finding-evidence {
            background: #f9fafb;
            padding: 8px;
            border-radius: 4px;
            font-size: 9px;
            color: #6b7280;
            font-family: 'Courier New', monospace;
        }

        .metadata-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10px;
        }

        .metadata-table th,
        .metadata-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .metadata-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #4b5563;
            width: 35%;
        }

        .metadata-table td {
            color: #1f2937;
        }

        .metadata-table tr:last-child th,
        .metadata-table tr:last-child td {
            border-bottom: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #f9fafb;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 9px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .footer {
            margin-top: 40px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
            text-align: center;
            font-size: 9px;
            color: #9ca3af;
        }

        .checkmark {
            color: #15803d;
            font-weight: 700;
        }

        .crossmark {
            color: #dc2626;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-top">
            <div class="logo">CypherX</div>
            <div class="report-title">
                <h1>PDF Document Verification Report</h1>
                <p>Generated on {{ timestamp }}</p>
            </div>
        </div>
        <div class="file-info">
            <p><strong>File Name:</strong> {{ file_name }}</p>
            <p><strong>Verification ID:</strong> {{ job_id }}</p>
        </div>
    </div>

    <!-- Verdict Card -->
    <div class="verdict-card">
        <div class="verdict-label">{{ verdict_label }}</div>
        <div class="verdict-description">{{ verdict_description }}</div>
        <div class="risk-score">
            <div class="risk-score-label">Risk Score</div>
            <div class="risk-score-bar">
                <div class="risk-score-fill" style="width: {{ risk_score }}%;"></div>
                <div class="risk-score-value">{{ risk_score }}/100</div>
            </div>
        </div>
    </div>

    <!-- Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">{{ total_findings }}</div>
            <div class="stat-label">Total Checks</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ failed_checks }}</div>
            <div class="stat-label">Failed</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ critical_findings|length + high_findings|length }}</div>
            <div class="stat-label">Critical/High</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ passed_checks|length }}</div>
            <div class="stat-label">Passed</div>
        </div>
    </div>

    <!-- Executive Summary -->
    <div class="section">
        <h2 class="section-title">Executive Summary</h2>
        <div class="executive-summary">
            {{ executive_summary }}
        </div>
    </div>

    <!-- Critical Findings -->
    {% if critical_findings %}
    <div class="section">
        <h2 class="section-title">🚨 Critical Findings</h2>
        <div class="findings-grid">
            {% for finding in critical_findings %}
            <div class="finding-card critical">
                <div class="finding-header">
                    <div class="finding-type">
                        <span class="crossmark">✗</span> {{ finding.type.replace('_', ' ').title() }}
                    </div>
                    <span class="finding-severity critical">{{ finding.severity }}</span>
                </div>
                <div class="finding-details">{{ finding.details }}</div>
                {% if finding.evidence %}
                <div class="finding-evidence">
                    {% for key, value in finding.evidence.items() %}
                    <div><strong>{{ key }}:</strong> {{ value }}</div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- High Findings -->
    {% if high_findings %}
    <div class="section">
        <h2 class="section-title">⚠️ High Risk Findings</h2>
        <div class="findings-grid">
            {% for finding in high_findings %}
            <div class="finding-card high">
                <div class="finding-header">
                    <div class="finding-type">
                        <span class="crossmark">✗</span> {{ finding.type.replace('_', ' ').title() }}
                    </div>
                    <span class="finding-severity high">{{ finding.severity }}</span>
                </div>
                <div class="finding-details">{{ finding.details }}</div>
                {% if finding.evidence %}
                <div class="finding-evidence">
                    {% for key, value in finding.evidence.items() %}
                    <div><strong>{{ key }}:</strong> {{ value }}</div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Medium Findings -->
    {% if medium_findings %}
    <div class="section">
        <h2 class="section-title">⚡ Medium Risk Findings</h2>
        <div class="findings-grid">
            {% for finding in medium_findings %}
            <div class="finding-card medium">
                <div class="finding-header">
                    <div class="finding-type">
                        <span class="crossmark">✗</span> {{ finding.type.replace('_', ' ').title() }}
                    </div>
                    <span class="finding-severity medium">{{ finding.severity }}</span>
                </div>
                <div class="finding-details">{{ finding.details }}</div>
                {% if finding.evidence %}
                <div class="finding-evidence">
                    {% for key, value in finding.evidence.items() %}
                    <div><strong>{{ key }}:</strong> {{ value }}</div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- PDF Metadata -->
    <div class="section">
        <h2 class="section-title">📄 Document Metadata</h2>
        <table class="metadata-table">
            <tr>
                <th>Creator Software</th>
                <td>{{ metadata.creator or 'Not specified' }}</td>
            </tr>
            <tr>
                <th>Producer Software</th>
                <td>{{ metadata.producer or 'Not specified' }}</td>
            </tr>
            <tr>
                <th>Creation Date</th>
                <td>{{ metadata.creation_date|format_date }}</td>
            </tr>
            <tr>
                <th>Modification Date</th>
                <td>{{ metadata.modification_date|format_date }}</td>
            </tr>
            <tr>
                <th>PDF Version</th>
                <td>{{ metadata.pdf_version or 'Unknown' }}</td>
            </tr>
            <tr>
                <th>Page Count</th>
                <td>{{ metadata.page_count or 'Unknown' }}</td>
            </tr>
            <tr>
                <th>File Size</th>
                <td>{{ (metadata.file_size_bytes / 1024 / 1024)|round(2) }} MB</td>
            </tr>
            <tr>
                <th>Encryption Status</th>
                <td>{{ 'Encrypted' if metadata.is_encrypted else 'Not encrypted' }}</td>
            </tr>
        </table>
    </div>

    <!-- Passed Checks (Summary) -->
    {% if passed_checks %}
    <div class="section">
        <h2 class="section-title">✓ Passed Verification Checks ({{ passed_checks|length }})</h2>
        <div class="findings-grid">
            {% for finding in passed_checks %}
            <div class="finding-card low">
                <div class="finding-header">
                    <div class="finding-type">
                        <span class="checkmark">✓</span> {{ finding.type.replace('_', ' ').title() }}
                    </div>
                    <span class="finding-severity low">PASS</span>
                </div>
                <div class="finding-details">{{ finding.details }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Footer -->
    <div class="footer">
        <p>This report was automatically generated by CypherX PDF Verification System</p>
        <p>For questions or concerns, please contact your system administrator</p>
    </div>
</body>
</html>
